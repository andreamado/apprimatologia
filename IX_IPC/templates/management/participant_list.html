{% extends "base.html" -%}

{% block main -%}
<div class="main-content-dark smaller-column text-white">
  <a href="{{ url_for('IX_IPC.management', language=lang) }}">
    <img style="width:25px" class="mb-3" src='data:image/svg+xml,<%3Fxml version="1.0" encoding="iso-8859-1"%3F><svg fill="%23fff" height="800px" width="800px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 384.97 384.97" xml:space="preserve"><g><g id="Arrow_Left_Circle"><path d="M192.485,0C86.185,0,0,86.185,0,192.485C0,298.797,86.185,384.97,192.485,384.97c106.312,0,192.485-86.173,192.485-192.485C384.97,86.185,298.797,0,192.485,0z M192.485,360.909c-93.018,0-168.424-75.406-168.424-168.424S99.467,24.061,192.485,24.061s168.424,75.406,168.424,168.424S285.503,360.909,192.485,360.909z"/><path d="M300.758,180.226H113.169l62.558-63.46c4.692-4.74,4.692-12.439,0-17.179c-4.704-4.74-12.319-4.74-17.011,0l-82.997,84.2c-2.25,2.25-3.537,5.414-3.537,8.59c0,3.164,1.299,6.328,3.525,8.59l82.997,84.2c4.704,4.752,12.319,4.74,17.011,0c4.704-4.752,4.704-12.439,0-17.191l-62.558-63.46h187.601c6.641,0,12.03-5.438,12.03-12.151C312.788,185.664,307.398,180.226,300.758,180.226z"/></g></g></svg>' alt="back">
  </a>
  <h2 class="lh-1 mb-4">Participants</h2>
  <button type="button" id="pdf-report-button" class="btn btn-primary mb-4">PDF list download</button>
  <button type="button" id="csv-summary-button" class="btn btn-primary mb-4">CSV summary download (Excel)</button>
  {% for participant in participants -%}
    <h4 class="mb-3">{{ participant.first_name }} {{ participant.last_name }} {{'(estudante)' if participant.student}}</h4>
    <p class="mb-2">Email: {{ participant.email }}</p>
    <p class="mb-2">Instituição: {{ participant.institution }}</p>
    {% if participant.paid_registration -%}
    <p class="mb-2">Pagou {{ participant.payment.value }}€ a {{ participant.payment.concluded.strftime('%d/%m/%Y') }} (via {{'MBWay' if participant.payment.method == 1 else 'Cartão de crédito' }})</p>
    {% endif -%}
    <h5 class="mt-4">Resumos submetidos:</h5>
    <div class="mb-3">
    {% for abstract in participant.submitted_abstracts %}
      <div class="submitted-abstract rounded-3 ps-4 my-2 py-2">
        <a data-abstract-id="{{ abstract.id }}" class="submitted-abstract" href="{{ url_for('IX_IPC.abstract_details', language=lang, id=abstract.id) }}">
          <p class="mb-0">Tipo: {{'apresentação oral' if abstract.abstract_type == 2 else 'poster'}}</p>
          <p class="mb-0">Título: {{abstract.title}}</p>
          <p class="mb-0">Palavras-chave: {{abstract.keywords}}</p>  
        </a>  
      </div>
    {% else %}
      <p class="mb-0">Sem resumos submetidos</p>
    {% endfor %}
    </div>
    <p class="mb-5"></p>
  {% endfor -%}
</div>

<script>
  document.getElementById('pdf-report-button').addEventListener('click', (evt) => {
    evt.preventDefault();
    window.open("{{ url_for('IX_IPC.participants_pdf_report') }}");
  });
  document.getElementById('csv-summary-button').addEventListener('click', (evt) => {
    evt.preventDefault();
    window.open("{{ url_for('IX_IPC.participants_csv_summary') }}");
  });
</script>
{% endblock -%}