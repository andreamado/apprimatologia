{% extends "base.html" -%}

{% block main -%}
<div class="main-content-dark smaller-column">
  <hr class="separator mb-5">
  <h1 id="IXIPC-title" class="lh-1 mb-4 text-white" data-offset="100">{{ 'IXIPC-title'|l10n(lang) }}</h1>
  <img class="mb-3" src="{{ url_for('static', filename='img/pexels-egor-kamelev-802208_small.jpg') }}" width="100%" alt="" style="opacity:0.9;">
  <div class="text-white lead mb-5">
    {{ 'IXIPC-description'|l10n(lang)|safe }}
  </div>

  <hr class="separator mb-5">

  <div class="text-white mb-5" id="essential-information">
    <h2 class="mb-1">{{ 'IXIPC-essential-information'|l10n(lang) }}</h2>
    <p class="lead mb-0">{{ 'IXIPC-dates'|l10n(lang) }}: <strong>{{ 'IXIPC-register-dates'|l10n(lang) }}</strong> (2024)</p>
    <p class="lead">{{ 'IXIPC-place'|l10n(lang) }}: <strong>Auditório Municipal - Vila do Conde</strong> (Portugal)</p>
    <div class="col-lg-6 text-end w-100">
      <iframe class="w-100" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d12331.156050207355!2d-8.750362500198147!3d41.35174212548796!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xd244406dbde29f3%3A0x4c7d869a165163ed!2sAudit%C3%B3rio%20Municipal!5e0!3m2!1sen!2spt!4v1710515659700!5m2!1sen!2spt" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
  </div>

  <div class="container">
    {% with messages = get_flashed_messages(with_categories=true) -%}
      {% if messages -%}
        {% for category, message in messages -%}
          <div class="alert alert-{{category}} rounded-4" role="alert">
            {{ message|safe }}
          </div>
        {% endfor -%}
      {% endif -%}
    {% endwith -%}
  </div>

  <hr class="separator mb-5">

  <div class="text-white mb-5" id="timeline">
    <h2 class="mb-4">{{ 'IXIPC-timeline'|l10n(lang) }}</h2>
    <div class="lead">
      <div class="row">
        <div class="col-4">mid April</div>
        <div class="col">Enrollment available</div>
      </div>
      <div class="row">
        <div class="col-4">June 25th</div>
        <div class="col">Abstract submission</div>
      </div>
      <div class="row">
        <div class="col-4">July 35th</div>
        <div class="col">Abstract selection</div>
      </div>
      <div class="row">
        <div class="col-4">August 12th</div>
        <div class="col">Payment deadline</div>
      </div>
      <div class="row">
        <div class="col-4">November 21-23</div>
        <div class="col">Conference</div>
      </div>  
    </div>
  </div>

  <hr class="separator mb-5">

  <div class="text-white mb-5" id="program">
    <h2 class="mb-4">{{ 'IXIPC-program'|l10n(lang) }}</h2>
    <h3 class="mb-3">{{ 'IXIPC-invited-speakers'|l10n(lang) }}</h3>
    <div class="row g-3 mb-5">
      <div class="col-12 col-sm-6 order-2 order-sm-1"><img class="IXIPC-invited-speaker w-100" src="{{ url_for('static', filename='img/man-person-black-and-white-photography-old-portrait-35917-pxhere.com.jpg') }}" alt=""></div>
      <div class="col-12 col-sm-6 order-1 order-sm-2">
        <h4>Zé Chimp</h4>
        Zé Chimp has been studying homo sapiens from time immemorial. He is one of the most famous humanologists in history.
        Zé Chimp will present his research on tool usage by homo sapiens, a subject that did not always received the attention it deserves.
      </div>
    </div>
    <div class="row g-3 mb-5">
      <div class="col-12 col-sm-6">
        <h4>Filipa Borges</h4>
        This person studies poo from primates. For some surprising reason, she decided to focus on non-human primates...
      </div>
      <div class="col-12 col-sm-6"><img class="IXIPC-invited-speaker w-100" src="{{ url_for('static', filename='img/1200px-Colobus_angolensis_3X2.jpg') }}" alt=""></div>
    </div>
  </div>

  <hr class="separator mb-5">

  {% if not g.IXIPC_user -%}

  <div class="text-white mb-5" id="personal-area">
    <h2 class="mb-1">{{ 'IXIPC-personal-area'|l10n(lang) }}</h2>
    <p class="lead">{{ 'IXIPC-register-to-submit'|l10n(lang) }}</p>
  </div>

  <div class="container mb-5">
    <!-- register form -->
    <div class="row mb-3">
      <div class="col-12 col-md-6 g-3">
        <div class="card rounded-4 mb-3 h-100">
          <div class="card-body">
            <h2 class="lh-1 mb-4">{{ 'IXIPC-register'|l10n(lang) }}</h2>
            <div class="row mb-3">
              <form action="{{ url_for('IX_IPC.register_user', language=lang) }}" method="post">
                {{ form.csrf_token }}
                <div class="col-12 mb-3">
                  <label for="first-name" class="form-label">{{ 'IXIPC-register-first-name'|l10n(lang) }}</label>
                  <input type="text" class="form-control" id="first-name" name="first-name">
                </div>
                {# <div class="col-12 mb-3">
                  <label for="last-name" class="form-label">{{ 'IXIPC-register-last-name'|l10n(lang) }}</label>
                  <input type="text" class="form-control" id="last-name" name="last-name">
                </div> #}
                <div class="col-12 mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="email" name="email">
                </div>
                <div class="col-2">
                  <button type="submit" class="btn btn-primary">{{ 'IXIPC-register-submit'|l10n(lang) }}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- login form -->
      <div class="col-12 col-md-6 g-3">
        <div class="card rounded-4 mb-3 h-100">
          <div class="card-body">
            <h2 class="lh-1 mb-4">{{ 'IXIPC-login'|l10n(lang) }}</h2>
            <div class="row mb-3">
              <form action="{{ url_for('IX_IPC.login', language=lang) }}" method="post">
                {{ form.csrf_token }}
                <div class="col-12 mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="email" name="email">
                </div>
                <div class="col-12 mb-3">
                  <label for="password" class="form-label">Password</label>
                  <input type="password" class="form-control" id="password" name="password">
                </div>
                <div class="col-2">
                  <button type="submit" class="btn btn-primary">{{ 'IXIPC-register-submit'|l10n(lang) }}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% else -%}
  <div class="text-white mb-5" id="personal-area">
      <h2 class="mb-1">{{ 'IXIPC-hi'|l10n(lang) }}, {{ g.IXIPC_user.name }}!</h2>
      <p class="lead mb-5">{{ 'IXIPC-register-to-submit-logged-in'|l10n(lang) }}</p>
    

    <div class="container text-white mb-5">
      <form id="personal-data" action="">
        {{ form.csrf_token }}
        <div class="rounded-4 card mb-3 abstract-new">
          <div class="card-body">
            <h5 class="card-title mb-0">
              {{ 'IXIPC-personal-data'|l10n(lang) }}
            </h5>
          </div>
        </div>
      </form>
      <div class="row mb-3">
        <div class="col">
          <label for="email" class="form-label">Email</label>
          <input class="form-control" name="email" id="email" type="text" value="{{g.IXIPC_user.email}}">
        </div>
      </div>
      <div class="row mb-3">
        <div class="col">
          <label for="first-name" class="form-label">{{ 'IXIPC-personal-data-first-name'|l10n(lang) }}</label>
          <input name="first-name" id="first-name" type="text" class="form-control">
        </div>
        <div class="col">
          <label for="last-name" class="form-label">{{ 'IXIPC-personal-data-last-name'|l10n(lang) }}</label>
          <input name="last-name" id="last-name" type="text" class="form-control">
        </div>
      </div>
      <div class="row mb-3">
        <div class="col">
          <label for="institution" class="form-label">{{ 'IXIPC-personal-data-institution'|l10n(lang) }}</label>
          <input name="institution" id="institution" type="text" class="form-control">
        </div>
      </div>
    </div>

    <div class="container text-white mb-5">
      <form action="">
        {{ form.csrf_token }}
        <div class="rounded-4 card mb-3 abstract-new">
          <div class="card-body">
            <h5 class="card-title mb-0">
              {{ 'IXIPC-abstract-body'|l10n(lang) }}s
            </h5>
          </div>
        </div>
      </form>

      <div class="container mb-5">
        <div id="abstract-forms-container">
          {% for abstract in abstracts -%}
          <div id="abstract-{{ abstract.id }}">
            {% include "abstract-form-closed.html" -%}
          </div>
          {% endfor -%}
        </div>
        <form id="abstract-new" action="" class="mb-5">
          {{ form.csrf_token }}
          <button type="button" class="btn btn-primary text-white" type="submit">
            <img src='data:image/svg+xml,<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 12H15" stroke="%23fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 9L12 15" stroke="%23fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 12C3 4.5885 4.5885 3 12 3C19.4115 3 21 4.5885 21 12C21 19.4115 19.4115 21 12 21C4.5885 21 3 19.4115 3 12Z" stroke="%23fff" stroke-width="2"/></svg>' alt="" style="height: 25px;">
            <span class="text-white">{{ 'IXIPC-abstract-new-abstract'|l10n(lang) }}</span>
          </button>
        </form>
      </div>
    </div>

    <!-- Authors -->
    <div class="container text-white mb-5">
      <form id="edit-authors" action="">
        {{ form.csrf_token }}
        <div class="rounded-4 card mb-3 abstract-new">
          <div class="card-body">
            <h5 class="card-title mb-0">
              {{ 'IXIPC-abstract-authors'|l10n(lang)|l10n(lang) }}
            </h5>
          </div>
        </div>
      </form>
    </div>
    <div class="container mb-5">
      <div class="row mb-3">
        <div class="accordion" id="accordionAuthors">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#author-1" aria-expanded="true" aria-controls="author-1">
                AAAAA
              </button>
            </h2>
            <div id="author-1" class="accordion-collapse collapse show" data-bs-parent="#accordionAuthors">
              <div class="accordion-body">
                <form action="">
                  <div class="row mb-3">
                    <div class="col">
                      <label for="first-name" class="form-label">{{ 'IXIPC-personal-data-first-name'|l10n(lang) }}</label>
                      <input name="first-name" id="first-name" type="text" class="form-control">
                    </div>
                    <div class="col">
                      <label for="last-name" class="form-label">{{ 'IXIPC-personal-data-last-name'|l10n(lang) }}</label>
                      <input name="last-name" id="last-name" type="text" class="form-control">
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#author-2" aria-expanded="false" aria-controls="author-2">
                BBBBB
              </button>
            </h2>
            <div id="author-2" class="accordion-collapse collapse" data-bs-parent="#accordionAuthors">
              <div class="accordion-body">
                <form action="">
                  <div class="row mb-3">
                    <div class="col">
                      <label for="first-name" class="form-label">{{ 'IXIPC-personal-data-first-name'|l10n(lang) }}</label>
                      <input name="first-name" id="first-name" type="text" class="form-control">
                    </div>
                    <div class="col">
                      <label for="last-name" class="form-label">{{ 'IXIPC-personal-data-last-name'|l10n(lang) }}</label>
                      <input name="last-name" id="last-name" type="text" class="form-control">
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#author-3" aria-expanded="false" aria-controls="author-3">
                CCCCC
              </button>
            </h2>
            <div id="author-3" class="accordion-collapse collapse" data-bs-parent="#accordionAuthors">
              <div class="accordion-body">
                <form action="">
                  <div class="row mb-3">
                    <div class="col">
                      <label for="first-name" class="form-label">{{ 'IXIPC-personal-data-first-name'|l10n(lang) }}</label>
                      <input name="first-name" id="first-name" type="text" class="form-control">
                    </div>
                    <div class="col">
                      <label for="last-name" class="form-label">{{ 'IXIPC-personal-data-last-name'|l10n(lang) }}</label>
                      <input name="last-name" id="last-name" type="text" class="form-control">
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
          {# <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button" type="button" id="author-new-button">
                <img width="20px" src='data:image/svg+xml,<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="1280pt" height="1280pt" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.1,-0.1)"fill="%23fff" stroke="none"><path d="M5150 12613 c-45 -7 -134 -57 -176 -98 -43 -41 -84 -102 -100 -145-5 -14 -11 -952 -14 -2225 l-5 -2200 -2200 -5 c-1256 -3 -2211 -9 -2225 -14-80 -29 -171 -114 -215 -200 l-30 -59 0 -1271 0 -1271 28 -56 c16 -31 39 -6751 -80 38 -40 85 -79 96 -79 5 0 10 -4 10 -8 0 -4 26 -17 58 -27 56 -20 103-20 2245 -23 l2187 -2 0 -2188 c0 -2306 -2 -2206 44 -2291 23 -44 105 -131122 -131 8 0 14 -4 14 -10 0 -5 5 -10 11 -10 6 0 25 -6 42 -13 86 -37 82 -371307 -37 880 0 1213 3 1239 12 73 23 121 43 121 51 0 4 6 7 13 7 20 0 102 90127 140 12 25 28 54 34 65 8 15 12 612 14 2212 l2 2193 2188 3 c2049 2 2190 32230 20 54 22 120 65 149 97 39 43 43 49 43 60 0 5 5 10 10 10 6 0 10 6 10 130 6 8 26 18 42 16 28 17 111 17 1305 0 1194 -1 1277 -17 1305 -10 17 -18 36-18 43 0 6 -4 12 -10 12 -5 0 -10 5 -10 11 0 29 -127 132 -190 155 -14 5 -96711 -2220 14 l-2195 5 -5 2190 c-5 1927 -7 2194 -21 2225 -46 106 -105 174-194 222 l-60 33 -1250 1 c-687 1 -1261 0 -1275 -3z"/></g></svg>' alt="">
                {{ 'IXIPC-abstract-new-author'|l10n(lang) }}
              </button>
            </h2>
          </div> #}
        </div>
      </div>  
      <button type="button" class="btn btn-primary text-white" type="submit">
        <img src='data:image/svg+xml,<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 12H15" stroke="%23fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 9L12 15" stroke="%23fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 12C3 4.5885 4.5885 3 12 3C19.4115 3 21 4.5885 21 12C21 19.4115 19.4115 21 12 21C4.5885 21 3 19.4115 3 12Z" stroke="%23fff" stroke-width="2"/></svg>' alt="" style="height: 25px;">
        <span class="text-white">{{ 'IXIPC-abstract-new-author'|l10n(lang) }}</span>
      </button>
    </div>
    
    <!-- Payment proof -->
    <div class="mb-5">
      <h4 class="mb-0">{{'IXIPC-upload-payment-proof'|l10n(lang)}}</h4>
      <img src="" alt="" id="upload-result" class="upload-result">
      {% with upload_area={'id': 'IXIPC-upload-payment-proof'} -%}
        {% include "partials/upload-form.html" -%}
      {% endwith -%}
      <p id="upload-result-text" class="lead upload-result-text">&nbsp;</p>
    </div>
    
    <!-- Logout -->
    <div class="mb-5">
      <form action="{{ url_for('IX_IPC.logout', language=lang) }}" method="post">
        {{ form.csrf_token }}
        <input type="hidden" id="user_id" name="user_id" value="{{ g.user.id }}"> 
        <button type="submit" class="btn btn-primary">{{ 'IXIPC-logout'|l10n(lang) }}</button>
      </form>  
    </div>
  </div>

  {% include "scripts/upload-form.html" -%}
  {% include "scripts/character-counter.html" -%}
  {% include "scripts/open-abstract.html" -%}
  
  <script src="{{ url_for('static', filename='js/Sortable.js') }}"></script>
  <script defer>
    makeUploader(
      dropArea = document.getElementById('IXIPC-upload-payment-proof'),
      csrfToken = '{{ csrf_token() }}'
    );
    const addAbstract = (event) => {
      event.preventDefault();
      let id = null;
      let container = document.getElementById('abstract-forms-container');
      fetch("{{ url_for('IX_IPC.create_new_abstract', language=lang) }}", {
        method: 'POST',
        body: new FormData(document.getElementById('abstract-new'))
      })
      .then((response) => response.json())
      .then((data) => {
        const div = document.createElement('div');
        id = data['id'];
        div.id = 'abstract-' + String(id);
        div.innerHTML = data['html'];
        container.appendChild(div);
      })
      .catch((e) => console.log(e));

      const callback = (mutationList, observer) => {
        document.getElementById('abstract-' + String(id)).scrollIntoView({behavior: "smooth", block: "center"});
        observer.disconnect();
      }

      const config = { attributes: false, childList: true, subtree: false };
      const observer = new MutationObserver(callback);
      observer.observe(container, config);
    }

    document.getElementById('abstract-new').addEventListener(
      'click',
      addAbstract
    );

    let authors = {};
  </script>
  {% endif -%}
  
  <hr class="separator mb-5">  
</div>

{% if site_map -%}
<div class="site-map">
  <a href="#IXIPC-title" class="nav-link">{{ 'IXIPC-title'|l10n(lang) }}</a>
  <a href="#essential-information" class="nav-link">{{ 'IXIPC-essential-information'|l10n(lang) }}</a>
  <a href="#timeline" class="nav-link">{{ 'IXIPC-timeline'|l10n(lang) }}</a>
  <a href="#program" class="nav-link">{{ 'IXIPC-program'|l10n(lang) }}</a>
  <a href="#personal-area" class="nav-link">{{ 'IXIPC-personal-area'|l10n(lang) }}</a>
</div>
{% endif -%}

{% endblock main -%}