{% extends "base.html" -%}

{% block main -%}
<div class="main-content-dark smaller-column">
  <hr class="separator mb-5">
  <h1 class="lh-1 mb-4 text-white">{{ 'IXIPC-title'|l10n(lang) }}</h1>
  <div class="text-white mb-5">
    {{ 'IXIPC-description'|l10n(lang)|safe }}
  </div>

  <hr class="separator mb-5">

  <div class="text-white mb-5" id="essential-information">
    <h2 class="mb-1">{{ 'IXIPC-essential-information'|l10n(lang) }}</h2>
    <p class="lead mb-0">{{ 'IXIPC-dates'|l10n(lang) }}: <strong>{{ 'IXIPC-register-dates'|l10n(lang) }}</strong> (2024)</p>
    <p class="lead">{{ 'IXIPC-place'|l10n(lang) }}: <strong>Auditório Municipal - Vila do Conde</strong> (Portugal)</p>
  </div>

  <div class="container">
    {% with messages = get_flashed_messages(with_categories=true) -%}
      {% if messages -%}
        {% for category, message in messages -%}
          <div class="alert alert-{{category}} rounded-4" role="alert">
            {{ message|safe }}
          </div>
        {% endfor -%}
      {% endif -%}
    {% endwith -%}
  </div>

  <hr class="separator mb-5">

  <div class="text-white mb-5" id="timeline">
    <h2 class="mb-1">{{ 'IXIPC-timeline'|l10n(lang) }}</h2>
  </div>

  <hr class="separator mb-5">

  <div class="text-white mb-5" id="program">
    <h2 class="mb-1">{{ 'IXIPC-program'|l10n(lang) }}</h2>
    <h3 class="mb-1">{{ 'IXIPC-invited-speakers'|l10n(lang) }}</h3>
    <div class="row">
      <div class="col-6"><img class="IXIPC-invited-speaker w-100" src="{{ url_for('static', filename='img/man-person-black-and-white-photography-old-portrait-35917-pxhere.com.jpg') }}" alt=""></div>
      <div class="col">
        <h4>Zé Chimp</h4>
        Zé Chimp has been studying homo sapiens from time immemorial. He is one of the most famous humanologists in history.
        Zé Chimp will present his research on tool usage by homo sapiens, a subject that did not always received the attention it deserves.
      </div>
    </div>
    <hr>
    <div class="row">
      <div class="col">
        <h4>Filipa Borges</h4>
        This person studies poo from primates. For some surprising reason, she decided to focus on non-human primates...
      </div>
      <div class="col-6"><img class="IXIPC-invited-speaker w-100" src="{{ url_for('static', filename='img/1200px-Colobus_angolensis_3X2.jpg') }}" alt=""></div>
    </div>

  </div>

  <hr class="separator mb-5">

  <div class="text-white mb-5" id="personal-area">
    <h2 class="mb-1">{{ 'IXIPC-personal-area'|l10n(lang) }}</h2>
    {% if not g.IXIPC_user -%}
    <p class="lead">{{ 'IXIPC-register-to-submit'|l10n(lang) }}</p>
    {% else -%}
    <p class="lead">{{ 'IXIPC-register-to-submit-logged-in'|l10n(lang) }}</p>
    {% endif -%}
  </div>


  {% if not g.IXIPC_user -%}
  <div class="container mb-5">
    <!-- register form -->
    <div class="row mb-3">
      <div class="col-12 col-md-6 g-3">
        <div class="card rounded-4 mb-3 h-100">
          <div class="card-body">
            <h2 class="lh-1 mb-4">{{ 'IXIPC-register'|l10n(lang) }}</h2>
            <div class="row mb-3">
              <form action="{{ url_for('IX_IPC.register_user', language=lang) }}" method="post">
                {{ form.csrf_token }}
                <div class="col-12 mb-3">
                  <label for="first-name" class="form-label">{{ 'IXIPC-register-first-name'|l10n(lang) }}</label>
                  <input type="text" class="form-control" id="first-name" name="first-name">
                </div>
                {# <div class="col-12 mb-3">
                  <label for="last-name" class="form-label">{{ 'IXIPC-register-last-name'|l10n(lang) }}</label>
                  <input type="text" class="form-control" id="last-name" name="last-name">
                </div> #}
                <div class="col-12 mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="email" name="email">
                </div>
                <div class="col-2">
                  <button type="submit" class="btn btn-primary">{{ 'IXIPC-register-submit'|l10n(lang) }}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- login form -->
      <div class="col-12 col-md-6 g-3">
        <div class="card rounded-4 mb-3 h-100">
          <div class="card-body">
            <h2 class="lh-1 mb-4">{{ 'IXIPC-login'|l10n(lang) }}</h2>
            <div class="row mb-3">
              <form action="{{ url_for('IX_IPC.login', language=lang) }}" method="post">
                {{ form.csrf_token }}
                <div class="col-12 mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="email" name="email">
                </div>
                <div class="col-12 mb-3">
                  <label for="password" class="form-label">Password</label>
                  <input type="password" class="form-control" id="password" name="password">
                </div>
                <div class="col-2">
                  <button type="submit" class="btn btn-primary">{{ 'IXIPC-register-submit'|l10n(lang) }}</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% else -%}
  <div class="container text-white mb-5">
    <h2 class="mb-5">{{ 'IXIPC-hi'|l10n(lang) }}, {{ g.IXIPC_user.name }}!</h2>

    <form id="abstract-new" action="">
      {{ form.csrf_token }}
      <div class="rounded-4 card mb-3 abstract-new">
        <div class="card-body">
          <h5 class="card-title mb-0">
            <img src='data:image/svg+xml,<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 12H15" stroke="%23fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 9L12 15" stroke="%23fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 12C3 4.5885 4.5885 3 12 3C19.4115 3 21 4.5885 21 12C21 19.4115 19.4115 21 12 21C4.5885 21 3 19.4115 3 12Z" stroke="%23fff" stroke-width="2"/></svg>' alt="" style="height: 25px;">
            {{ 'IXIPC-abstract-new-abstract'|l10n(lang) }}
          </h5>
        </div>
      </div>
    </form>

    <div id="abstract-forms-container">
      {% for abstract in abstracts -%}
      <div id="abstract-{{ abstract.id }}">
        {% include "abstract-form-closed.html" -%}
      </div>
      {% endfor -%}
    </div>
    
    <div class="mb-5">
      <h4 class="mb-0">{{'IXIPC-upload-payment-proof'|l10n(lang)}}</h4>
      <img src="" alt="" id="upload-result" class="upload-result">
      {% with upload_area={'id': 'IXIPC-upload-payment-proof'} -%}
        {% include "partials/upload-form.html" -%}
      {% endwith -%}
      <p id="upload-result-text" class="lead upload-result-text">&nbsp;</p>
    </div>

    <div class="mb-5">
      <form action="{{ url_for('IX_IPC.logout', language=lang) }}" method="post">
        {{ form.csrf_token }}
        <input type="hidden" id="user_id" name="user_id" value="{{ g.user.id }}"> 
        <button type="submit" class="btn btn-primary">{{ 'IXIPC-logout'|l10n(lang) }}</button>
      </form>  
    </div>
  </div>

  {% include "scripts/upload-form.html" -%}
  {% include "scripts/character-counter.html" -%}
  {% include "scripts/open-abstract.html" -%}
  
  <script>
    makeUploader(
      dropArea = document.getElementById('IXIPC-upload-payment-proof'),
      csrfToken = '{{ csrf_token() }}'
    );
    const addAbstract = () => {
      let id = null;
      let container = document.getElementById('abstract-forms-container');
      fetch("{{ url_for('IX_IPC.create_new_abstract', language=lang) }}", {
        method: 'POST',
        body: new FormData(document.getElementById('abstract-new'))
      })
      .then((response) => response.json())
      .then((data) => {
        const div = document.createElement('div');
        div.id = 'abstract-' + String(data['id']);
        div.innerHTML = data['html'];
        container.appendChild(div);
      })
      .catch((e) => console.log(e));
    }

    document.getElementById('abstract-new').addEventListener(
      'click',
      addAbstract
    );
  </script>
  {% endif -%}
  <hr class="separator mb-5">
</div>
{% endblock main -%}